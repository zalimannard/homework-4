<div class="myWrapper" align="center" markdown="1">

# :books: Моделирование операций, Задание №4

</div>

## :mortar_board: Формулировка задания

Решите задачу ЦЛП - задачу коммивояжера методом ветвей и границ.

На Луну космическим кораблем был доставлен луноход в расположение моря Нектара (1) для сбора образцов лунных пород со следующих морей: Изобилия (2), Кризисов (3), Спокойствия (4), Ясности (5). Лунные моря представляют собой застывшую лаву, их темная окраска определяется содержанием темного минерала ильменита. Расстояния между морями представлены в виде матрицы.

Постройте кратчайший кольцевой маршрут объезда луноходом всех морей.

## :scroll: Входные данные

| Моря из\в (Lij) | Нектара (1) | Изобилия (2) | Кризисов (3) | Спокойствия (4) | Ясности (5) |
| - | - | - | - | - | - |
| Нектара (1) | - | 61 | 122 | 75 | 133 |
| Изобилия (2) | 61 | - | 72 | 68 | 129 |
| Кризисов (3) | 122 | 72 | - | 78 | 106 |
| Спокойствия (4) | 75 | 68 | 78 | - | 65 |
| Ясности (5) | 133 | 129 | 106 | 65 | - |

## :computer: Сборка и запуск

Для запуска потребуется `java 18` и выше и `gradle` к ней.

```shell
git clone https://github.com/zalimannard/homework-4
cd homework-4/simulation-of-operations/lab-4
gradle build
java -jar lab-4-1.0-SNAPSHOT.jar distances.csv
```

### Файл `distances.csv`:

- Названия должны быть только строками. Число не подойдёт. Можете попытаться обмануть, например, пробелом.
- Надпись в левом верхнем углу должна быть обязательно
- Поддерживаются только целые числа

## :movie_camera: Ход работы

### 1. Приведение строк

Для каждой строки ищем минимальный элемент. Записываем их в отдельный столбик, а из всех значений строки его вычитаем:

| Моря из\в (Lij) | Нектара (1) | Изобилия (2) | Кризисов (3) | Спокойствия (4) | Ясности (5) | Минимум |
| - | - | - | - | - | - | - |
| Нектара (1) | - | 0 | 61 | 14 | 72 | 61 |
| Изобилия (2) | 0 | - | 11 | 7 | 68 | 61 |
| Кризисов (3) | 50 | 0 | - | 6 | 34 | 72 |
| Спокойствия (4) | 10 | 3 | 13 | - | 0 | 65 |
| Ясности (5) | 68 | 64 | 41 | 0 | - | 65 |

### 2. Приведение столбцов

Для каждого столбца ищем минимальный элемент. Записываем их в отдельную строку, а из всех значений строки его вычитаем:

| Моря из\в (Lij) | Нектара (1) | Изобилия (2) | Кризисов (3) | Спокойствия (4) | Ясности (5) | Минимум |
| - | - | - | - | - | - | - |
| Нектара (1) | - | 0 | 50 | 14 | 72 | 61 |
| Изобилия (2) | 0 | - | 11 | 7 | 68 | 61 |
| Кризисов (3) | 50 | 0 | - | 6 | 34 | 72 |
| Спокойствия (4) | 10 | 3 | 2 | - | 0 | 65 |
| Ясности (5) | 68 | 64 | 30 | 0 | - | 65 |
| Минимум | 0 | 0 | 11 | 0 | 0 |  |

### 3. Вычисление верхней границы

Суммируем все получившиеся в шагах [1](#1-приведение-строк) и [2](#2-приведение-столбцов) минимумы:

| Моря из\в (Lij) | Нектара (1) | Изобилия (2) | Кризисов (3) | Спокойствия (4) | Ясности (5) | Минимум |
| - | - | - | - | - | - | - |
| Нектара (1) | - | 0 | 50 | 14 | 72 | 61 |
| Изобилия (2) | 0 | - | 11 | 7 | 68 | 61 |
| Кризисов (3) | 50 | 0 | - | 6 | 34 | 72 |
| Спокойствия (4) | 10 | 3 | 2 | - | 0 | 65 |
| Ясности (5) | 68 | 64 | 30 | 0 | - | 65 |
| Минимум | 0 | 0 | 11 | 0 | 0 | 335 |

335 - Наша верхняя граница

### 4. Нахождение рёбер ветвления

Для каждого элемента из шага [3](#3-вычисление-верхней-границы), равного нулю, посчитаем число, равное сумме минимального элемента строки и минимального элемента столбца, в которых находится рассматриваемый 0. Получится что-то типа потенциалов

| Моря из\в (Lij) | Нектара (1) | Изобилия (2) | Кризисов (3) | Спокойствия (4) | Ясности (5)
| - | - | - | - | - | - |
| Нектара (1) |  | 14 |  |  |  |
| Изобилия (2) | 10 |  | 2 |  |  |
| Кризисов (3) |  | 6 |  |  |  |
| Спокойствия (4) |  |  |  |  | 36 |
| Ясности (5) |  |  |  | 36 |  |

### 5. Рассмотрение рёбер ветвления

Максимальных элементов после шага [4](#4-нахождение-рёбер-ветвления). Оба нужно рассмотреть

#### 5.1. Элемент (4,5) - из Спокойствия в Ясность

На самом деле, рассмотреть надо не 2, а уже целых 4 варианта. Для этой вершины можно сделать 2 предположения:

#### 5.1.1. Она не входит в путь - случай `(4*,5*)`

Делаем эту вершину недоступной для посещения:

| Моря из\в | Нектара (1) | Изобилия (2) | Кризисов (3) | Спокойствия (4) | Ясности (5) |
| - | - | - | - | - | - |
| Нектара (1) | - | 0 | 50 | 14 | 72 |
| Изобилия (2) | 0 | - | 11 | 7 | 68 |
| Кризисов (3) | 50 | 0 | - | 6 | 34 |
| Спокойствия (4) | 10 | 3 | 2 | - | - |
| Ясности (5) | 68 | 64 | 30 | 0 | - |

Далее считаем для неё верхнюю границу. См пункты [1](#1-приведение-строк), [2](#2-приведение-столбцов), [3](#3-вычисление-верхней-границы)

В этом конкретном случае верхняя граница будет `36`

#### 5.1.2. Она входит в путь - случай `(4,5)`

Делаем симметричную вершину недоступной для посещения, чтобы не появилось циклов:

| Моря из\в | Нектара (1) | Изобилия (2) | Кризисов (3) | Спокойствия (4) | Ясности (5) |
| - | - | - | - | - | - |
| Нектара (1) | - | 0 | 50 | 14 | 72 |
| Изобилия (2) | 0 | - | 11 | 7 | 68 |
| Кризисов (3) | 50 | 0 | - | 6 | 34 |
| Спокойствия (4) | 10 | 3 | 2 | - | 0 |
| Ясности (5) | 68 | 64 | 30 | - | - |

Удаляем столбец и строку с этой вершиной. Если осталась таблица 1x1, то оптимальное решение найдено

| Моря из\в | Нектара (1) | Изобилия (2) | Кризисов (3) | Спокойствия (4) |
| - | - | - | - | - |
| Нектара (1) | - | 0 | 50 | 14 |
| Изобилия (2) | 0 | - | 11 | 7 |
| Кризисов (3) | 50 | 0 | - | 6 |
| Ясности (5) | 68 | 64 | 30 | - |

Далее считаем для неё верхнюю границу. См пункты [1](#1-приведение-строк), [2](#2-приведение-столбцов), [3](#3-вычисление-верхней-границы)

В этом конкретном случае верхняя граница будет `36`

### 6. Анализ границ

- Если случай, когда вершина входит в путь имеет значение границы меньше либо равное, чем когда не входит, то мы можем быть не верном пути - нужно продолжать решение, отталкиваясь от таблице из шага [5.1.2.](#512-она-входит-в-путь---случай-45)
- Если нет, то тогда решение проигрышное и нужно откатываться к шагу [5](#5-рассмотрение-рёбер-ветвления) и смотреть на другие варианты использования нулей. При этом вариант, который был рассмотрен больше не должен быть в таблице

### Результат

Оптимальный путь:

`Нектара -> Спокойствия -> Ясности -> Кризисов -> Изобилия -> Нектара`

## :ocean: Материалы

[Math.semester. Задача коммивояжера](https://math.semestr.ru/kom/index.php) - заставили меня мучаться несколько дополнительных часов из-за того, что у них самих сайт решает неправильно. Но понять суть можно. Может и на ошибку не наткнётесь, в отличие от меня.

[Хабр. Метод ветвей и границ. Задача коммивояжера](https://habr.com/ru/post/560468/) - в статье 6749 слов. Это в полтора раза больше чем у меня в курсовой. Прочитать и понять полностью это нереально, но тоже может помочь местами

[YouTube лекция ФПМИ. Метод ветвей и границ](https://www.youtube.com/watch?v=vWVfodR30TU) - мужик понятно рассказал, но мало. Только им не обойтись

## :bookmark: Примечание

- Для некоторых условий решение выдаёт неверный ответ. Я не знаю, почему так происходит и не очень хочу разбираться, но если кто-то захочет эту проблему решить, то могу присоединиться.
- Момент с вычислением значения границы занимает места больше, чем должен. Там довольно много кода не нужно. Можете его сократить и закнуть сюда запрос.
